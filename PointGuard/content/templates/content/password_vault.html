{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Password Vault</h1>
    {% if user_passwords %}
    <div class="row">
        {% for password in user_passwords %}
        <div class="col-md-4 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h3 class="card-title">{{ password.website }}</h3>
                    <p class="card-text">Username: {{ password.username }}</p>
                    <p class="card-text">Last Updated: {{ password.updated_at|date:"F d, Y" }}</p>
                    <a href="{% url 'edit_password' password.id %}" class="btn btn-primary">Edit</a>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal" data-passwordid="{{ password.id }}">
                        Delete
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center">
        {% load static %}
        <img src="{% static 'images/sad_knight_no_passwords.png' %}" alt="Image" />
        <p>No passwords found. Add some to secure your information.</p>
    </div>
    {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this password?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="delete-confirm">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    $('#deleteModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var passwordId = button.data('passwordid');
        var modal = $(this);
        modal.find('.modal-body').text('Are you sure you want to delete the password for ' + button.closest('.card-body').find('.card-title').text() + '?');
        modal.find('#delete-confirm').data('passwordid', passwordId);
    });

    $('#delete-confirm').click(function() {
        var passwordId = $(this).data('passwordid');
        $.ajax({
            url: '{% url "delete_password" 0 %}'.replace('0', passwordId),
            type: 'post',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (response) {
                if(response.status == 'success') {
                    $('div[data-passwordid="' + passwordId + '"]').fadeOut('slow', function() { $(this).remove(); });
                    $('#deleteModal').modal('hide');
                }
            }
        });
    });
</script>

<style>
    .card {
        background-color: #EDF6F9;
        color: #006D77;
        border-left: 5px solid #E29578;
    }
    .card-title {
        font-size: 1.5rem;
        font-weight: bold;
    }
    .card-text {
        font-size: 1rem;
    }
</style>
{% endblock %}


{% comment %} {% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1><strong>Password Vault</strong></h1>
    {% if user_passwords %}
    <div class="row">
        {% for password in user_passwords %}
        <div class="col-md-4 mb-4" data-passwordid="{{ password.id }}">
            <div class="card shadow h-100">
                <div class="card-body">
                    <h3 class="card-title">{{ password.website }}</h3>
                    <p class="card-text">Username: {{ password.username }}</p>
                    <p class="card-text">Last Updated: {{ password.updated_at|date:"F d, Y" }}</p>
                    <a href="{% url 'edit_password' password.id %}" class="btn btn-primary">Edit</a>
                    <button class="btn btn-danger" data-passwordid="{{ password.id }}" data-deleteurl="{% url 'delete_password' password.id %}" onclick="confirmDelete(this)">Delete</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center;">
        {% load static %}
        <img src="{% static 'images/sad_knight_no_passwords.png' %}" alt="Image" />
    </div>
    {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this password?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="delete-confirm">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmDelete(buttonElement) {
        var passwordId = buttonElement.getAttribute('data-passwordid');
        var deleteUrl = buttonElement.getAttribute('data-deleteurl');
    
        if(confirm('Are you sure you want to delete this password?')) {
            $.ajax({
                url: deleteUrl,
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (response) {
                    if(response.status == 'success') {
                        $(buttonElement).closest('.col-md-4').fadeOut('slow', function() { $(this).remove(); });
                    } else {
                        alert('Error: ' + response.error);
                    }
                },
                error: function () {
                    alert('Failed to delete the password.');
                }
            });
        }
    }
    </script>
    
    

<style>
    .card {
        background-color: #EDF6F9; /* Lightest blue for the background */
        color: #006D77; /* Dark blue text for contrast */
        font-family: Arial, sans-serif; /* Clean, modern font */
    }
    .card-title {
        font-size: 1.5rem; /* Larger font for the title */
        font-weight: bold; /* Bold for better visibility */
    }
    .card-text {
        font-size: 1rem; /* Regular font size for the text */
    }
    .card-body {
        padding: 1.25rem; /* Padding for the card body */
    }
    .container {
        max-width: 1200px; /* Optional: Restrict maximum width of the container for better aesthetics */
    }
</style>
{% endblock %} {% endcomment %}